// ğŸ”’ Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ï¼ˆæœ¬ç•ªç”¨ï¼‰
// Firebase Console ã® Rules ã‚¿ãƒ–ã«ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ğŸ“‹ requests ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé…é”è¦è«‹ï¼‰
    match /requests/{requestId} {
      // èª°ã§ã‚‚èª­ã¿å–ã‚Šå¯èƒ½ï¼ˆè¢«ç½è€…ãƒ»é…é”å“¡ãŒè¦è«‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ï¼‰
      allow read: if true;
      
      // æ–°è¦ä½œæˆã¯èª°ã§ã‚‚å¯èƒ½ï¼ˆè¢«ç½è€…ãŒç·Šæ€¥è¦è«‹ã‚’é€ã‚‹ãŸã‚ï¼‰
      allow create: if true;
      
      // æ›´æ–°ã¯åˆ¶é™ä»˜ãã§è¨±å¯ï¼ˆé…é”å“¡ãŒçŠ¶æ³æ›´æ–°ã™ã‚‹ãŸã‚ï¼‰
      allow update: if 
        // æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã®é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¤‰æ›´ä¸å¯
        !('requesterName' in resource.data) ||
        !('item' in resource.data) ||
        !('phone' in resource.data) ||
        !('latitude' in resource.data) ||
        !('longitude' in resource.data) ||
        !('timestamp' in resource.data) ||
        // é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿è¨±å¯
        (resource.data.requesterName == request.data.requesterName &&
         resource.data.item == request.data.item &&
         resource.data.phone == request.data.phone &&
         resource.data.latitude == request.data.latitude &&
         resource.data.longitude == request.data.longitude &&
         resource.data.timestamp == request.data.timestamp);
      
      // å‰Šé™¤ã¯å®Œå…¨ã«ç¦æ­¢ï¼ˆãƒ‡ãƒ¼ã‚¿ä¿æŒã®ãŸã‚ï¼‰
      allow delete: if false;
    }
    
    // ğŸ“Š deliveries ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé…é”å±¥æ­´ï¼‰
    match /deliveries/{deliveryId} {
      // èª­ã¿å–ã‚Šã¯èª°ã§ã‚‚å¯èƒ½ï¼ˆçµ±è¨ˆæƒ…å ±ã®ãŸã‚ï¼‰
      allow read: if true;
      
      // ä½œæˆã®ã¿è¨±å¯ï¼ˆå±¥æ­´ã¯è¿½åŠ ã®ã¿ï¼‰
      allow create: if true;
      
      // æ›´æ–°ãƒ»å‰Šé™¤ã¯ç¦æ­¢ï¼ˆå±¥æ­´æ”¹ã–ã‚“é˜²æ­¢ï¼‰
      allow update, delete: if false;
    }
    
    // ğŸ”’ ãã®ä»–ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥è¿½åŠ ç”¨ï¼‰
    match /{document=**} {
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯èª­ã¿å–ã‚Šã®ã¿
      allow read: if true;
      allow write: if false;
    }
  }
}

/*
ğŸ›¡ï¸ æœ¬ç•ªç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è§£èª¬ï¼š
âœ… è¨±å¯ã•ã‚Œã‚‹ã“ã¨ï¼š
- èª°ã§ã‚‚è¦è«‹ã®èª­ã¿å–ã‚Šï¼ˆç·Šæ€¥æ™‚ã®é€æ˜æ€§ï¼‰
- èª°ã§ã‚‚æ–°è¦è¦è«‹ã®ä½œæˆï¼ˆè¢«ç½è€…ã®ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
- é…é”å“¡ã«ã‚ˆã‚‹é…é”çŠ¶æ³ã®æ›´æ–°ï¼ˆstatusã‚„deliveryPersonIdã®ã¿ï¼‰
- é…é”å±¥æ­´ã®ä½œæˆãƒ»èª­ã¿å–ã‚Š

âŒ ç¦æ­¢ã•ã‚Œã‚‹ã“ã¨ï¼š
- è¦è«‹ã®é‡è¦æƒ…å ±ã®å¤‰æ›´ï¼ˆrequesterName, item, phone, ä½ç½®æƒ…å ±ç­‰ï¼‰
- è¦è«‹ãƒ»å±¥æ­´ã®å‰Šé™¤
- é…é”å±¥æ­´ã®å¤‰æ›´

ğŸš¨ ç½å®³æ™‚ã®ç‰¹åˆ¥è€ƒæ…®ï¼š
- ç·Šæ€¥æ€§ã‚’å„ªå…ˆã—ã¦èªè¨¼ãªã—ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ãŸã ã—é‡è¦ãƒ‡ãƒ¼ã‚¿ã®æ”¹ã–ã‚“ã¯é˜²æ­¢
- å°†æ¥çš„ã«èªè¨¼æ©Ÿèƒ½è¿½åŠ æ™‚ã¯èªè¨¼å¿…é ˆã«å¤‰æ›´å¯èƒ½
*/