// ğŸ”’ Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ï¼ˆèªè¨¼æ©Ÿèƒ½è¿½åŠ ç‰ˆï¼‰
// Firebase Console ã® Rules ã‚¿ãƒ–ã«ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ğŸ“‹ requests ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé…é”è¦è«‹ï¼‰- æ—¢å­˜ãƒ«ãƒ¼ãƒ«ç¶­æŒ
    match /requests/{requestId} {
      // èª°ã§ã‚‚èª­ã¿å–ã‚Šå¯èƒ½ï¼ˆè¢«ç½è€…ãƒ»é…é”å“¡ãŒè¦è«‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ï¼‰
      allow read: if true;
      
      // æ–°è¦ä½œæˆã¯èª°ã§ã‚‚å¯èƒ½ï¼ˆè¢«ç½è€…ãŒç·Šæ€¥è¦è«‹ã‚’é€ã‚‹ãŸã‚ï¼‰
      allow create: if true;
      
      // æ›´æ–°ã¯åˆ¶é™ä»˜ãã§è¨±å¯ï¼ˆé…é”å“¡ãŒçŠ¶æ³æ›´æ–°ã™ã‚‹ãŸã‚ï¼‰
      allow update: if 
        // æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã®é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¤‰æ›´ä¸å¯
        !('requesterName' in resource.data) ||
        !('item' in resource.data) ||
        !('phone' in resource.data) ||
        !('latitude' in resource.data) ||
        !('longitude' in resource.data) ||
        !('timestamp' in resource.data) ||
        // é‡è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿è¨±å¯
        (resource.data.requesterName == request.data.requesterName &&
         resource.data.item == request.data.item &&
         resource.data.phone == request.data.phone &&
         resource.data.latitude == request.data.latitude &&
         resource.data.longitude == request.data.longitude &&
         resource.data.timestamp == request.data.timestamp);
      
      // å‰Šé™¤ã¯å®Œå…¨ã«ç¦æ­¢ï¼ˆãƒ‡ãƒ¼ã‚¿ä¿æŒã®ãŸã‚ï¼‰
      allow delete: if false;
    }
    
    // ğŸ“Š deliveries ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé…é”å±¥æ­´ï¼‰- æ—¢å­˜ãƒ«ãƒ¼ãƒ«ç¶­æŒ
    match /deliveries/{deliveryId} {
      // èª­ã¿å–ã‚Šã¯èª°ã§ã‚‚å¯èƒ½ï¼ˆçµ±è¨ˆæƒ…å ±ã®ãŸã‚ï¼‰
      allow read: if true;
      
      // ä½œæˆã®ã¿è¨±å¯ï¼ˆå±¥æ­´ã¯è¿½åŠ ã®ã¿ï¼‰
      allow create: if true;
      
      // æ›´æ–°ãƒ»å‰Šé™¤ã¯ç¦æ­¢ï¼ˆå±¥æ­´æ”¹ã–ã‚“é˜²æ­¢ï¼‰
      allow update, delete: if false;
    }
    
    // ğŸšš delivery_persons ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé…é”å“¡ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼‰- æ–°è¦è¿½åŠ 
    match /delivery_persons/{deliveryPersonId} {
      // èª°ã§ã‚‚èª­ã¿å–ã‚Šå¯èƒ½ï¼ˆç½å®³æ™‚èº«å…ƒç¢ºèªã®ãŸã‚ï¼‰
      allow read: if true;
      
      // ä½œæˆï¼šèªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã¿
      allow create: if request.auth != null && 
                       request.auth.uid == deliveryPersonId;
      
      // æ›´æ–°ï¼šèªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã¿
      allow update: if request.auth != null && 
                       request.auth.uid == deliveryPersonId;
      
      // å‰Šé™¤ã¯ç¦æ­¢ï¼ˆç½å®³æ™‚èº«å…ƒä¿æŒï¼‰
      allow delete: if false;
    }
    
    // ğŸ  shelters ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé¿é›£æ‰€æƒ…å ±ï¼‰- æ—¢å­˜æ©Ÿèƒ½
    match /shelters/{shelterId} {
      // èª°ã§ã‚‚èª­ã¿å–ã‚Šå¯èƒ½ï¼ˆç½å®³æ™‚å…¬å…±æƒ…å ±ï¼‰
      allow read: if true;
      
      // æ›¸ãè¾¼ã¿ã¯ç¾çŠ¶ç¦æ­¢ï¼ˆç®¡ç†è€…æ©Ÿèƒ½ã¯å¾Œã§è¿½åŠ ï¼‰
      allow write: if false;
    }
    
    // ğŸ”’ ãã®ä»–ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥è¿½åŠ ç”¨ï¼‰- æ—¢å­˜ãƒ«ãƒ¼ãƒ«ç¶­æŒ
    match /{document=**} {
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯èª­ã¿å–ã‚Šã®ã¿
      allow read: if true;
      allow write: if false;
    }
  }
}

/*
ğŸ›¡ï¸ èªè¨¼æ©Ÿèƒ½è¿½åŠ å¾Œã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è§£èª¬ï¼š
âœ… æ—¢å­˜æ©Ÿèƒ½ï¼ˆå¤‰æ›´ãªã—ï¼‰ï¼š
- èª°ã§ã‚‚è¦è«‹ã®èª­ã¿å–ã‚Šãƒ»ä½œæˆï¼ˆç·Šæ€¥æ™‚å¯¾å¿œï¼‰
- é…é”çŠ¶æ³ã®æ›´æ–°ï¼ˆé‡è¦ãƒ‡ãƒ¼ã‚¿ä¿è­·ï¼‰
- é…é”å±¥æ­´ã®ä½œæˆãƒ»èª­ã¿å–ã‚Š

âœ… æ–°è¦è¿½åŠ æ©Ÿèƒ½ï¼š
- é…é”å“¡ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†ï¼ˆèªè¨¼å¿…é ˆï¼‰
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆStorageé€£æºï¼‰

ğŸš¨ ç½å®³æ™‚ã®ç‰¹åˆ¥è€ƒæ…®ï¼ˆç¶­æŒï¼‰ï¼š
- è¢«ç½è€…å´ã®ç·Šæ€¥ã‚¢ã‚¯ã‚»ã‚¹ã¯èªè¨¼ä¸è¦
- é…é”å“¡å´ã¯èº«å…ƒç¢ºèªã®ãŸã‚èªè¨¼å¿…é ˆ
- ãƒ‡ãƒ¼ã‚¿æ”¹ã–ã‚“ãƒ»å‰Šé™¤é˜²æ­¢ã¯ç¶™ç¶š
*/